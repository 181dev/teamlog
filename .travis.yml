language: node_js
node_js:
  - "0.11"
services:
  - mongodb
before_script:
  - sleep 15
  - mongo mydb_test --eval 'db.addUser("travis", "test");'
  - npm install
  - wget https://github.com/n1k0/casperjs/archive/1.0.2.tar.gz -O /tmp/casper.tar.gz
  - tar -xvf /tmp/casper.tar.gz
  - export PATH=$PATH:$PWD/casperjs-1.0.2/bin/
env:
  - MONGODB_URL=mongodb://127.0.0.1:27017
script:
  - npm start
  - sleep 3
  - casperjs test test/casper.js
